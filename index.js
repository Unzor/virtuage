var fs = require("fs");
if (!fs.existsSync("machine.jpg")) {
	fs.writeFileSync("machine.jpg", "");
}
var isRunning = false;
const {
  spawn
} = require("child_process");
var settings = JSON.parse(fs.readFileSync("settings.json").toString());
settings.vnc = "127.0.0.1:1";

function json_to_args(e) {
  var n = [];
  for (var t in e) {
    n.push("-" + t + " " + e[t]);
  }
  return n.join(" ")
}

settings = json_to_args(settings);
const VncClient = require("vnc-rfb-client");
const Jimp = require("jimp");
spawn(`qemu-system-x86_64 ${settings}`, {
  shell: true,
  stdio: "inherit"
});
var index = 0;
const express = require("express");
const app = express();
const http = require("http");
var keysyms = {
    "0": "0xffb0",
    "1": "0xffb1",
    "2": "0xffb2",
    "3": "0xffb3",
    "4": "0xffb4",
    "5": "0xffb5",
    "6": "0xffb6",
    "7": "0xffb7",
    "8": "0xffb8",
    "9": "0xffb9",
    " ": "0x0020",
    "!": "0x0021",
    "\"": "0x0022",
    "#": "0x0023",
    "$": "0x0024",
    "%": "0x0025",
    "&": "0x0026",
    "'": "0x0027",
    "(": "0x14a5",
    ")": "0x14a4",
    "*": "0xffaa",
    "+": "0xffab",
    ",": "0x14ab",
    "-": "0xffad",
    ".": "0x14a9",
    "/": "0xffaf",
    ":": "0x003a",
    ";": "0x003b",
    "<": "0x0ba3",
    "=": "0xffbd",
    ">": "0x0ba6",
    "?": "0x003f",
    "@": "0x0040",
    "A": "0x0041",
    "B": "0x0042",
    "C": "0x0043",
    "D": "0x0044",
    "E": "0x0045",
    "F": "0x0046",
    "G": "0x0047",
    "H": "0x0048",
    "I": "0x0049",
    "J": "0x004a",
    "K": "0x004b",
    "L": "0x004c",
    "M": "0x004d",
    "N": "0x004e",
    "O": "0x004f",
    "P": "0x0050",
    "Q": "0x0051",
    "R": "0x0052",
    "S": "0x0053",
    "T": "0x0054",
    "U": "0x0055",
    "V": "0x0056",
    "W": "0x0057",
    "X": "0x0058",
    "Y": "0x0059",
    "Z": "0x005a",
    "[": "0x005b",
    "\\": "0x005c",
    "]": "0x005d",
    "^": "0x005e",
    "_": "0x0bc6",
    "`": "0x0060",
    "a": "0x0061",
    "b": "0x0062",
    "c": "0x0063",
    "d": "0x0064",
    "e": "0x0065",
    "f": "0x0066",
    "g": "0x0067",
    "h": "0x0068",
    "i": "0x0069",
    "j": "0x006a",
    "k": "0x006b",
    "l": "0x006c",
    "m": "0x006d",
    "n": "0x006e",
    "o": "0x006f",
    "p": "0x0070",
    "q": "0x0071",
    "r": "0x0072",
    "s": "0x0073",
    "t": "0x0074",
    "u": "0x0075",
    "v": "0x0076",
    "w": "0x0077",
    "x": "0x0078",
    "y": "0x0079",
    "z": "0x007a",
    "{": "0x007b",
    "|": "0x007c",
    "}": "0x007d",
    "~": "0x007e",
    " ": "0x00a0",
    "¡": "0x00a1",
    "¢": "0x00a2",
    "£": "0x00a3",
    "¤": "0x00a4",
    "¥": "0x00a5",
    "¦": "0x00a6",
    "§": "0x14ff",
    "¨": "0x00a8",
    "©": "0x00a9",
    "ª": "0x00aa",
    "«": "0x14a7",
    "¬": "0x00ac",
    "­": "0x00ad",
    "®": "0x00ae",
    "¯": "0x0bc0",
    "°": "0x00b0",
    "±": "0x00b1",
    "²": "0x00b2",
    "³": "0x00b3",
    "´": "0x00b4",
    "µ": "0x00b5",
    "¶": "0x00b6",
    "·": "0x00b7",
    "¸": "0x00b8",
    "¹": "0x00b9",
    "º": "0x00ba",
    "»": "0x14a6",
    "¼": "0x00bc",
    "½": "0x00bd",
    "¾": "0x00be",
    "¿": "0x00bf",
    "À": "0x00c0",
    "Á": "0x00c1",
    "Â": "0x00c2",
    "Ã": "0x00c3",
    "Ä": "0x00c4",
    "Å": "0x00c5",
    "Æ": "0x00c6",
    "Ç": "0x00c7",
    "È": "0x00c8",
    "É": "0x00c9",
    "Ê": "0x00ca",
    "Ë": "0x00cb",
    "Ì": "0x00cc",
    "Í": "0x00cd",
    "Î": "0x00ce",
    "Ï": "0x00cf",
    "Ð": "0x00d0",
    "Ñ": "0x00d1",
    "Ò": "0x00d2",
    "Ó": "0x00d3",
    "Ô": "0x00d4",
    "Õ": "0x00d5",
    "Ö": "0x00d6",
    "×": "0x00d7",
    "Ø": "0x00d8",
    "Ù": "0x00d9",
    "Ú": "0x00da",
    "Û": "0x00db",
    "Ü": "0x00dc",
    "Ý": "0x00dd",
    "Þ": "0x00de",
    "ß": "0x00df",
    "à": "0x00e0",
    "á": "0x00e1",
    "â": "0x00e2",
    "ã": "0x00e3",
    "ä": "0x00e4",
    "å": "0x00e5",
    "æ": "0x00e6",
    "ç": "0x00e7",
    "è": "0x00e8",
    "é": "0x00e9",
    "ê": "0x00ea",
    "ë": "0x00eb",
    "ì": "0x00ec",
    "í": "0x00ed",
    "î": "0x00ee",
    "ï": "0x00ef",
    "ð": "0x00f0",
    "ñ": "0x00f1",
    "ò": "0x00f2",
    "ó": "0x00f3",
    "ô": "0x00f4",
    "õ": "0x00f5",
    "ö": "0x00f6",
    "÷": "0x00f7",
    "ø": "0x00f8",
    "ù": "0x00f9",
    "ú": "0x00fa",
    "û": "0x00fb",
    "ü": "0x00fc",
    "ý": "0x00fd",
    "þ": "0x00fe",
    "ÿ": "0x00ff",
    "Ą": "0x01a1",
    "˘": "0x01a2",
    "Ł": "0x01a3",
    "Ľ": "0x01a5",
    "Ś": "0x01a6",
    "Š": "0x01a9",
    "Ş": "0x01aa",
    "Ť": "0x01ab",
    "Ź": "0x01ac",
    "Ž": "0x01ae",
    "Ż": "0x01af",
    "ą": "0x01b1",
    "˛": "0x01b2",
    "ł": "0x01b3",
    "ľ": "0x01b5",
    "ś": "0x01b6",
    "ˇ": "0x01b7",
    "š": "0x01b9",
    "ş": "0x01ba",
    "ť": "0x01bb",
    "ź": "0x01bc",
    "˝": "0x01bd",
    "ž": "0x01be",
    "ż": "0x01bf",
    "Ŕ": "0x01c0",
    "Ă": "0x01c3",
    "Ĺ": "0x01c5",
    "Ć": "0x01c6",
    "Č": "0x01c8",
    "Ę": "0x01ca",
    "Ě": "0x01cc",
    "Ď": "0x01cf",
    "Đ": "0x01d0",
    "Ń": "0x01d1",
    "Ň": "0x01d2",
    "Ő": "0x01d5",
    "Ř": "0x01d8",
    "Ů": "0x01d9",
    "Ű": "0x01db",
    "Ţ": "0x01de",
    "ŕ": "0x01e0",
    "ă": "0x01e3",
    "ĺ": "0x01e5",
    "ć": "0x01e6",
    "č": "0x01e8",
    "ę": "0x01ea",
    "ě": "0x01ec",
    "ď": "0x01ef",
    "đ": "0x01f0",
    "ń": "0x01f1",
    "ň": "0x01f2",
    "ő": "0x01f5",
    "ř": "0x01f8",
    "ů": "0x01f9",
    "ű": "0x01fb",
    "ţ": "0x01fe",
    "˙": "0x01ff",
    "Ħ": "0x02a1",
    "Ĥ": "0x02a6",
    "İ": "0x02a9",
    "Ğ": "0x02ab",
    "Ĵ": "0x02ac",
    "ħ": "0x02b1",
    "ĥ": "0x02b6",
    "ı": "0x02b9",
    "ğ": "0x02bb",
    "ĵ": "0x02bc",
    "Ċ": "0x02c5",
    "Ĉ": "0x02c6",
    "Ġ": "0x02d5",
    "Ĝ": "0x02d8",
    "Ŭ": "0x02dd",
    "Ŝ": "0x02de",
    "ċ": "0x02e5",
    "ĉ": "0x02e6",
    "ġ": "0x02f5",
    "ĝ": "0x02f8",
    "ŭ": "0x02fd",
    "ŝ": "0x02fe",
    "ĸ": "0x03a2",
    "Ŗ": "0x03a3",
    "Ĩ": "0x03a5",
    "Ļ": "0x03a6",
    "Ē": "0x03aa",
    "Ģ": "0x03ab",
    "Ŧ": "0x03ac",
    "ŗ": "0x03b3",
    "ĩ": "0x03b5",
    "ļ": "0x03b6",
    "ē": "0x03ba",
    "ģ": "0x03bb",
    "ŧ": "0x03bc",
    "Ŋ": "0x03bd",
    "ŋ": "0x03bf",
    "Ā": "0x03c0",
    "Į": "0x03c7",
    "Ė": "0x03cc",
    "Ī": "0x03cf",
    "Ņ": "0x03d1",
    "Ō": "0x03d2",
    "Ķ": "0x03d3",
    "Ų": "0x03d9",
    "Ũ": "0x03dd",
    "Ū": "0x03de",
    "ā": "0x03e0",
    "į": "0x03e7",
    "ė": "0x03ec",
    "ī": "0x03ef",
    "ņ": "0x03f1",
    "ō": "0x03f2",
    "ķ": "0x03f3",
    "ų": "0x03f9",
    "ũ": "0x03fd",
    "ū": "0x03fe",
    "‾": "0x047e",
    "。": "0x04a1",
    "「": "0x04a2",
    "」": "0x04a3",
    "、": "0x04a4",
    "・": "0x04a5",
    "ヲ": "0x04a6",
    "ァ": "0x04a7",
    "ィ": "0x04a8",
    "ゥ": "0x04a9",
    "ェ": "0x04aa",
    "ォ": "0x04ab",
    "ャ": "0x04ac",
    "ュ": "0x04ad",
    "ョ": "0x04ae",
    "ッ": "0x04af",
    "ー": "0x04b0",
    "ア": "0x04b1",
    "イ": "0x04b2",
    "ウ": "0x04b3",
    "エ": "0x04b4",
    "オ": "0x04b5",
    "カ": "0x04b6",
    "キ": "0x04b7",
    "ク": "0x04b8",
    "ケ": "0x04b9",
    "コ": "0x04ba",
    "サ": "0x04bb",
    "シ": "0x04bc",
    "ス": "0x04bd",
    "セ": "0x04be",
    "ソ": "0x04bf",
    "タ": "0x04c0",
    "チ": "0x04c1",
    "ツ": "0x04c2",
    "テ": "0x04c3",
    "ト": "0x04c4",
    "ナ": "0x04c5",
    "ニ": "0x04c6",
    "ヌ": "0x04c7",
    "ネ": "0x04c8",
    "ノ": "0x04c9",
    "ハ": "0x04ca",
    "ヒ": "0x04cb",
    "フ": "0x04cc",
    "ヘ": "0x04cd",
    "ホ": "0x04ce",
    "マ": "0x04cf",
    "ミ": "0x04d0",
    "ム": "0x04d1",
    "メ": "0x04d2",
    "モ": "0x04d3",
    "ヤ": "0x04d4",
    "ユ": "0x04d5",
    "ヨ": "0x04d6",
    "ラ": "0x04d7",
    "リ": "0x04d8",
    "ル": "0x04d9",
    "レ": "0x04da",
    "ロ": "0x04db",
    "ワ": "0x04dc",
    "ン": "0x04dd",
    "゛": "0x04de",
    "゜": "0x04df",
    "،": "0x05ac",
    "؛": "0x05bb",
    "؟": "0x05bf",
    "ء": "0x05c1",
    "آ": "0x05c2",
    "أ": "0x05c3",
    "ؤ": "0x05c4",
    "إ": "0x05c5",
    "ئ": "0x05c6",
    "ا": "0x05c7",
    "ب": "0x05c8",
    "ة": "0x05c9",
    "ت": "0x05ca",
    "ث": "0x05cb",
    "ج": "0x05cc",
    "ح": "0x05cd",
    "خ": "0x05ce",
    "د": "0x05cf",
    "ذ": "0x05d0",
    "ر": "0x05d1",
    "ز": "0x05d2",
    "س": "0x05d3",
    "ش": "0x05d4",
    "ص": "0x05d5",
    "ض": "0x05d6",
    "ط": "0x05d7",
    "ظ": "0x05d8",
    "ع": "0x05d9",
    "غ": "0x05da",
    "ـ": "0x05e0",
    "ف": "0x05e1",
    "ق": "0x05e2",
    "ك": "0x05e3",
    "ل": "0x05e4",
    "م": "0x05e5",
    "ن": "0x05e6",
    "ه": "0x05e7",
    "و": "0x05e8",
    "ى": "0x05e9",
    "ي": "0x05ea",
    "ً": "0x05eb",
    "ٌ": "0x05ec",
    "ٍ": "0x05ed",
    "َ": "0x05ee",
    "ُ": "0x05ef",
    "ِ": "0x05f0",
    "ّ": "0x05f1",
    "ْ": "0x05f2",
    "ђ": "0x06a1",
    "ѓ": "0x06a2",
    "ё": "0x06a3",
    "є": "0x06a4",
    "ѕ": "0x06a5",
    "і": "0x06a6",
    "ї": "0x06a7",
    "ј": "0x06a8",
    "љ": "0x06a9",
    "њ": "0x06aa",
    "ћ": "0x06ab",
    "ќ": "0x06ac",
    "ў": "0x06ae",
    "џ": "0x06af",
    "№": "0x06b0",
    "Ђ": "0x06b1",
    "Ѓ": "0x06b2",
    "Ё": "0x06b3",
    "Є": "0x06b4",
    "Ѕ": "0x06b5",
    "І": "0x06b6",
    "Ї": "0x06b7",
    "Ј": "0x06b8",
    "Љ": "0x06b9",
    "Њ": "0x06ba",
    "Ћ": "0x06bb",
    "Ќ": "0x06bc",
    "Ў": "0x06be",
    "Џ": "0x06bf",
    "ю": "0x06c0",
    "а": "0x06c1",
    "б": "0x06c2",
    "ц": "0x06c3",
    "д": "0x06c4",
    "е": "0x06c5",
    "ф": "0x06c6",
    "г": "0x06c7",
    "х": "0x06c8",
    "и": "0x06c9",
    "й": "0x06ca",
    "к": "0x06cb",
    "л": "0x06cc",
    "м": "0x06cd",
    "н": "0x06ce",
    "о": "0x06cf",
    "п": "0x06d0",
    "я": "0x06d1",
    "р": "0x06d2",
    "с": "0x06d3",
    "т": "0x06d4",
    "у": "0x06d5",
    "ж": "0x06d6",
    "в": "0x06d7",
    "ь": "0x06d8",
    "ы": "0x06d9",
    "з": "0x06da",
    "ш": "0x06db",
    "э": "0x06dc",
    "щ": "0x06dd",
    "ч": "0x06de",
    "ъ": "0x06df",
    "Ю": "0x06e0",
    "А": "0x06e1",
    "Б": "0x06e2",
    "Ц": "0x06e3",
    "Д": "0x06e4",
    "Е": "0x06e5",
    "Ф": "0x06e6",
    "Г": "0x06e7",
    "Х": "0x06e8",
    "И": "0x06e9",
    "Й": "0x06ea",
    "К": "0x06eb",
    "Л": "0x06ec",
    "М": "0x06ed",
    "Н": "0x06ee",
    "О": "0x06ef",
    "П": "0x06f0",
    "Я": "0x06f1",
    "Р": "0x06f2",
    "С": "0x06f3",
    "Т": "0x06f4",
    "У": "0x06f5",
    "Ж": "0x06f6",
    "В": "0x06f7",
    "Ь": "0x06f8",
    "Ы": "0x06f9",
    "З": "0x06fa",
    "Ш": "0x06fb",
    "Э": "0x06fc",
    "Щ": "0x06fd",
    "Ч": "0x06fe",
    "Ъ": "0x06ff",
    "Ά": "0x07a1",
    "Έ": "0x07a2",
    "Ή": "0x07a3",
    "Ί": "0x07a4",
    "Ϊ": "0x07a5",
    "Ό": "0x07a7",
    "Ύ": "0x07a8",
    "Ϋ": "0x07a9",
    "Ώ": "0x07ab",
    "΅": "0x07ae",
    "―": "0x07af",
    "ά": "0x07b1",
    "έ": "0x07b2",
    "ή": "0x07b3",
    "ί": "0x07b4",
    "ϊ": "0x07b5",
    "ΐ": "0x07b6",
    "ό": "0x07b7",
    "ύ": "0x07b8",
    "ϋ": "0x07b9",
    "ΰ": "0x07ba",
    "ώ": "0x07bb",
    "Α": "0x07c1",
    "Β": "0x07c2",
    "Γ": "0x07c3",
    "Δ": "0x07c4",
    "Ε": "0x07c5",
    "Ζ": "0x07c6",
    "Η": "0x07c7",
    "Θ": "0x07c8",
    "Ι": "0x07c9",
    "Κ": "0x07ca",
    "Λ": "0x07cb",
    "Μ": "0x07cc",
    "Ν": "0x07cd",
    "Ξ": "0x07ce",
    "Ο": "0x07cf",
    "Π": "0x07d0",
    "Ρ": "0x07d1",
    "Σ": "0x07d2",
    "Τ": "0x07d4",
    "Υ": "0x07d5",
    "Φ": "0x07d6",
    "Χ": "0x07d7",
    "Ψ": "0x07d8",
    "Ω": "0x07d9",
    "α": "0x07e1",
    "β": "0x07e2",
    "γ": "0x07e3",
    "δ": "0x07e4",
    "ε": "0x07e5",
    "ζ": "0x07e6",
    "η": "0x07e7",
    "θ": "0x07e8",
    "ι": "0x07e9",
    "κ": "0x07ea",
    "λ": "0x07eb",
    "μ": "0x07ec",
    "ν": "0x07ed",
    "ξ": "0x07ee",
    "ο": "0x07ef",
    "π": "0x07f0",
    "ρ": "0x07f1",
    "σ": "0x07f2",
    "ς": "0x07f3",
    "τ": "0x07f4",
    "υ": "0x07f5",
    "φ": "0x07f6",
    "χ": "0x07f7",
    "ψ": "0x07f8",
    "ω": "0x07f9",
    "⎷": "0x08a1",
    "┌": "0x09ec",
    "─": "0x09f1",
    "⌠": "0x08a4",
    "⌡": "0x08a5",
    "│": "0x09f8",
    "⎡": "0x08a7",
    "⎣": "0x08a8",
    "⎤": "0x08a9",
    "⎦": "0x08aa",
    "⎛": "0x08ab",
    "⎝": "0x08ac",
    "⎞": "0x08ad",
    "⎠": "0x08ae",
    "⎨": "0x08af",
    "⎬": "0x08b0",
    "\u0000": "0x16e3",
    "≤": "0x08bc",
    "≠": "0x08bd",
    "≥": "0x08be",
    "∫": "0x08bf",
    "∴": "0x08c0",
    "∝": "0x08c1",
    "∞": "0x08c2",
    "∇": "0x08c5",
    "∼": "0x08c8",
    "≃": "0x08c9",
    "⇔": "0x08cd",
    "⇒": "0x08ce",
    "≡": "0x08cf",
    "√": "0x08d6",
    "⊂": "0x0bda",
    "⊃": "0x0bd8",
    "∩": "0x0bc3",
    "∪": "0x0bd6",
    "∧": "0x0ba9",
    "∨": "0x0ba8",
    "∂": "0x08ef",
    "ƒ": "0x08f6",
    "←": "0x08fb",
    "↑": "0x08fc",
    "→": "0x08fd",
    "↓": "0x08fe",
    "◆": "0x09e0",
    "▒": "0x09e1",
    "␉": "0x09e2",
    "␌": "0x09e3",
    "␍": "0x09e4",
    "␊": "0x09e5",
    "␤": "0x09e8",
    "␋": "0x09e9",
    "┘": "0x09ea",
    "┐": "0x09eb",
    "└": "0x09ed",
    "┼": "0x09ee",
    "⎺": "0x09ef",
    "⎻": "0x09f0",
    "⎼": "0x09f2",
    "⎽": "0x09f3",
    "├": "0x09f4",
    "┤": "0x09f5",
    "┴": "0x09f6",
    "┬": "0x09f7",
    " ": "0x0aa1",
    " ": "0x0aa2",
    " ": "0x0aa3",
    " ": "0x0aa4",
    " ": "0x0aa5",
    " ": "0x0aa6",
    " ": "0x0aa7",
    " ": "0x0aa8",
    "—": "0x14a8",
    "–": "0x14ac",
    "␣": "0x0aac",
    "…": "0x14ae",
    "‥": "0x0aaf",
    "⅓": "0x0ab0",
    "⅔": "0x0ab1",
    "⅕": "0x0ab2",
    "⅖": "0x0ab3",
    "⅗": "0x0ab4",
    "⅘": "0x0ab5",
    "⅙": "0x0ab6",
    "⅚": "0x0ab7",
    "℅": "0x0ab8",
    "‒": "0x0abb",
    "⟨": "0x0abc",
    "⟩": "0x0abe",
    "⅛": "0x0ac3",
    "⅜": "0x0ac4",
    "⅝": "0x0ac5",
    "⅞": "0x0ac6",
    "™": "0x0ac9",
    "☓": "0x0aca",
    "◁": "0x0acc",
    "▷": "0x0acd",
    "○": "0x0bcf",
    "▯": "0x0acf",
    "‘": "0x0ad0",
    "’": "0x0ad1",
    "“": "0x0ad2",
    "”": "0x0ad3",
    "℞": "0x0ad4",
    "′": "0x0ad6",
    "″": "0x0ad7",
    "✝": "0x0ad9",
    "▬": "0x0adb",
    "◀": "0x0adc",
    "▶": "0x0add",
    "●": "0x0ade",
    "▮": "0x0adf",
    "◦": "0x0ae0",
    "▫": "0x0ae1",
    "▭": "0x0ae2",
    "△": "0x0ae3",
    "▽": "0x0ae4",
    "☆": "0x0ae5",
    "•": "0x0ae6",
    "▪": "0x0ae7",
    "▲": "0x0ae8",
    "▼": "0x0ae9",
    "☜": "0x0aea",
    "☞": "0x0aeb",
    "♣": "0x0aec",
    "♦": "0x0aed",
    "♥": "0x0aee",
    "✠": "0x0af0",
    "†": "0x0af1",
    "‡": "0x0af2",
    "✓": "0x0af3",
    "✗": "0x0af4",
    "♯": "0x0af5",
    "♭": "0x0af6",
    "♂": "0x0af7",
    "♀": "0x0af8",
    "☎": "0x0af9",
    "⌕": "0x0afa",
    "℗": "0x0afb",
    "‸": "0x0afc",
    "‚": "0x0afd",
    "„": "0x0afe",
    "⊥": "0x0bc2",
    "⌊": "0x0bc4",
    "∘": "0x0bca",
    "⎕": "0x0bcc",
    "⊤": "0x0bce",
    "⌈": "0x0bd3",
    "⊢": "0x0bdc",
    "⊣": "0x0bfc",
    "‗": "0x0cdf",
    "א": "0x0ce0",
    "ב": "0x0ce1",
    "ג": "0x0ce2",
    "ד": "0x0ce3",
    "ה": "0x0ce4",
    "ו": "0x0ce5",
    "ז": "0x0ce6",
    "ח": "0x0ce7",
    "ט": "0x0ce8",
    "י": "0x0ce9",
    "ך": "0x0cea",
    "כ": "0x0ceb",
    "ל": "0x0cec",
    "ם": "0x0ced",
    "מ": "0x0cee",
    "ן": "0x0cef",
    "נ": "0x0cf0",
    "ס": "0x0cf1",
    "ע": "0x0cf2",
    "ף": "0x0cf3",
    "פ": "0x0cf4",
    "ץ": "0x0cf5",
    "צ": "0x0cf6",
    "ק": "0x0cf7",
    "ר": "0x0cf8",
    "ש": "0x0cf9",
    "ת": "0x0cfa",
    "ก": "0x0da1",
    "ข": "0x0da2",
    "ฃ": "0x0da3",
    "ค": "0x0da4",
    "ฅ": "0x0da5",
    "ฆ": "0x0da6",
    "ง": "0x0da7",
    "จ": "0x0da8",
    "ฉ": "0x0da9",
    "ช": "0x0daa",
    "ซ": "0x0dab",
    "ฌ": "0x0dac",
    "ญ": "0x0dad",
    "ฎ": "0x0dae",
    "ฏ": "0x0daf",
    "ฐ": "0x0db0",
    "ฑ": "0x0db1",
    "ฒ": "0x0db2",
    "ณ": "0x0db3",
    "ด": "0x0db4",
    "ต": "0x0db5",
    "ถ": "0x0db6",
    "ท": "0x0db7",
    "ธ": "0x0db8",
    "น": "0x0db9",
    "บ": "0x0dba",
    "ป": "0x0dbb",
    "ผ": "0x0dbc",
    "ฝ": "0x0dbd",
    "พ": "0x0dbe",
    "ฟ": "0x0dbf",
    "ภ": "0x0dc0",
    "ม": "0x0dc1",
    "ย": "0x0dc2",
    "ร": "0x0dc3",
    "ฤ": "0x0dc4",
    "ล": "0x0dc5",
    "ฦ": "0x0dc6",
    "ว": "0x0dc7",
    "ศ": "0x0dc8",
    "ษ": "0x0dc9",
    "ส": "0x0dca",
    "ห": "0x0dcb",
    "ฬ": "0x0dcc",
    "อ": "0x0dcd",
    "ฮ": "0x0dce",
    "ฯ": "0x0dcf",
    "ะ": "0x0dd0",
    "ั": "0x0dd1",
    "า": "0x0dd2",
    "ำ": "0x0dd3",
    "ิ": "0x0dd4",
    "ี": "0x0dd5",
    "ึ": "0x0dd6",
    "ื": "0x0dd7",
    "ุ": "0x0dd8",
    "ู": "0x0dd9",
    "ฺ": "0x0dda",
    "฿": "0x0ddf",
    "เ": "0x0de0",
    "แ": "0x0de1",
    "โ": "0x0de2",
    "ใ": "0x0de3",
    "ไ": "0x0de4",
    "ๅ": "0x0de5",
    "ๆ": "0x0de6",
    "็": "0x0de7",
    "่": "0x0de8",
    "้": "0x0de9",
    "๊": "0x0dea",
    "๋": "0x0deb",
    "์": "0x0dec",
    "ํ": "0x0ded",
    "๐": "0x0df0",
    "๑": "0x0df1",
    "๒": "0x0df2",
    "๓": "0x0df3",
    "๔": "0x0df4",
    "๕": "0x0df5",
    "๖": "0x0df6",
    "๗": "0x0df7",
    "๘": "0x0df8",
    "๙": "0x0df9",
    "ㄱ": "0x0ea1",
    "ㄲ": "0x0ea2",
    "ㄳ": "0x0ea3",
    "ㄴ": "0x0ea4",
    "ㄵ": "0x0ea5",
    "ㄶ": "0x0ea6",
    "ㄷ": "0x0ea7",
    "ㄸ": "0x0ea8",
    "ㄹ": "0x0ea9",
    "ㄺ": "0x0eaa",
    "ㄻ": "0x0eab",
    "ㄼ": "0x0eac",
    "ㄽ": "0x0ead",
    "ㄾ": "0x0eae",
    "ㄿ": "0x0eaf",
    "ㅀ": "0x0eb0",
    "ㅁ": "0x0eb1",
    "ㅂ": "0x0eb2",
    "ㅃ": "0x0eb3",
    "ㅄ": "0x0eb4",
    "ㅅ": "0x0eb5",
    "ㅆ": "0x0eb6",
    "ㅇ": "0x0eb7",
    "ㅈ": "0x0eb8",
    "ㅉ": "0x0eb9",
    "ㅊ": "0x0eba",
    "ㅋ": "0x0ebb",
    "ㅌ": "0x0ebc",
    "ㅍ": "0x0ebd",
    "ㅎ": "0x0ebe",
    "ㅏ": "0x0ebf",
    "ㅐ": "0x0ec0",
    "ㅑ": "0x0ec1",
    "ㅒ": "0x0ec2",
    "ㅓ": "0x0ec3",
    "ㅔ": "0x0ec4",
    "ㅕ": "0x0ec5",
    "ㅖ": "0x0ec6",
    "ㅗ": "0x0ec7",
    "ㅘ": "0x0ec8",
    "ㅙ": "0x0ec9",
    "ㅚ": "0x0eca",
    "ㅛ": "0x0ecb",
    "ㅜ": "0x0ecc",
    "ㅝ": "0x0ecd",
    "ㅞ": "0x0ece",
    "ㅟ": "0x0ecf",
    "ㅠ": "0x0ed0",
    "ㅡ": "0x0ed1",
    "ㅢ": "0x0ed2",
    "ㅣ": "0x0ed3",
    "ᆨ": "0x0ed4",
    "ᆩ": "0x0ed5",
    "ᆪ": "0x0ed6",
    "ᆫ": "0x0ed7",
    "ᆬ": "0x0ed8",
    "ᆭ": "0x0ed9",
    "ᆮ": "0x0eda",
    "ᆯ": "0x0edb",
    "ᆰ": "0x0edc",
    "ᆱ": "0x0edd",
    "ᆲ": "0x0ede",
    "ᆳ": "0x0edf",
    "ᆴ": "0x0ee0",
    "ᆵ": "0x0ee1",
    "ᆶ": "0x0ee2",
    "ᆷ": "0x0ee3",
    "ᆸ": "0x0ee4",
    "ᆹ": "0x0ee5",
    "ᆺ": "0x0ee6",
    "ᆻ": "0x0ee7",
    "ᆼ": "0x0ee8",
    "ᆽ": "0x0ee9",
    "ᆾ": "0x0eea",
    "ᆿ": "0x0eeb",
    "ᇀ": "0x0eec",
    "ᇁ": "0x0eed",
    "ᇂ": "0x0eee",
    "ㅭ": "0x0eef",
    "ㅱ": "0x0ef0",
    "ㅸ": "0x0ef1",
    "ㅿ": "0x0ef2",
    "ㆁ": "0x0ef3",
    "ㆄ": "0x0ef4",
    "ㆆ": "0x0ef5",
    "ㆍ": "0x0ef6",
    "ㆎ": "0x0ef7",
    "ᇫ": "0x0ef8",
    "ᇰ": "0x0ef9",
    "ᇹ": "0x0efa",
    "₩": "0x20a9",
    "Œ": "0x13bc",
    "œ": "0x13bd",
    "Ÿ": "0x13be",
    "₠": "0x20a0",
    "₡": "0x20a1",
    "₢": "0x20a2",
    "₣": "0x20a3",
    "₤": "0x20a4",
    "₥": "0x20a5",
    "₦": "0x20a6",
    "₧": "0x20a7",
    "₨": "0x20a8",
    "₪": "0x20aa",
    "₫": "0x20ab",
    "€": "0x20ac",
    "̀": "0x1ef2",
    "́": "0x1ef3",
    "̂": "0xfe52",
    "̃": "0x1e9f",
    "̄": "0xfe54",
    "̆": "0xfe55",
    "̇": "0xfe56",
    "̈": "0xfe57",
    "̊": "0xfe58",
    "̋": "0xfe59",
    "̌": "0xfe5a",
    "̧": "0xfe5b",
    "̨": "0xfe5c",
    "ͅ": "0xfe5d",
    "゙": "0xfe5e",
    "゚": "0xfe5f",
    "\b": "0xff08",
    "\t": "0xff89",
    "\n": "0xff0a",
    "\u000b": "0xff0b",
    "\r": "0xff8d",
    "\u0013": "0xff13",
    "\u0014": "0xff14",
    "\u0015": "0xff15",
    "\u001b": "0xff1b",
    "և": "0x14a2",
    "։": "0x14a3",
    "՝": "0x14aa",
    "֊": "0x14ad",
    "՜": "0x14af",
    "՛": "0x14b0",
    "՞": "0x14b1",
    "Ա": "0x14b2",
    "ա": "0x14b3",
    "Բ": "0x14b4",
    "բ": "0x14b5",
    "Գ": "0x14b6",
    "գ": "0x14b7",
    "Դ": "0x14b8",
    "դ": "0x14b9",
    "Ե": "0x14ba",
    "ե": "0x14bb",
    "Զ": "0x14bc",
    "զ": "0x14bd",
    "Է": "0x14be",
    "է": "0x14bf",
    "Ը": "0x14c0",
    "ը": "0x14c1",
    "Թ": "0x14c2",
    "թ": "0x14c3",
    "Ժ": "0x14c4",
    "ժ": "0x14c5",
    "Ի": "0x14c6",
    "ի": "0x14c7",
    "Լ": "0x14c8",
    "լ": "0x14c9",
    "Խ": "0x14ca",
    "խ": "0x14cb",
    "Ծ": "0x14cc",
    "ծ": "0x14cd",
    "Կ": "0x14ce",
    "կ": "0x14cf",
    "Հ": "0x14d0",
    "հ": "0x14d1",
    "Ձ": "0x14d2",
    "ձ": "0x14d3",
    "Ղ": "0x14d4",
    "ղ": "0x14d5",
    "Ճ": "0x14d6",
    "ճ": "0x14d7",
    "Մ": "0x14d8",
    "մ": "0x14d9",
    "Յ": "0x14da",
    "յ": "0x14db",
    "Ն": "0x14dc",
    "ն": "0x14dd",
    "Շ": "0x14de",
    "շ": "0x14df",
    "Ո": "0x14e0",
    "ո": "0x14e1",
    "Չ": "0x14e2",
    "չ": "0x14e3",
    "Պ": "0x14e4",
    "պ": "0x14e5",
    "Ջ": "0x14e6",
    "ջ": "0x14e7",
    "Ռ": "0x14e8",
    "ռ": "0x14e9",
    "Ս": "0x14ea",
    "ս": "0x14eb",
    "Վ": "0x14ec",
    "վ": "0x14ed",
    "Տ": "0x14ee",
    "տ": "0x14ef",
    "Ր": "0x14f0",
    "ր": "0x14f1",
    "Ց": "0x14f2",
    "ց": "0x14f3",
    "Ւ": "0x14f4",
    "ւ": "0x14f5",
    "Փ": "0x14f6",
    "փ": "0x14f7",
    "Ք": "0x14f8",
    "ք": "0x14f9",
    "Օ": "0x14fa",
    "օ": "0x14fb",
    "Ֆ": "0x14fc",
    "ֆ": "0x14fd",
    "՚": "0x14fe",
    "ა": "0x15d0",
    "ბ": "0x15d1",
    "გ": "0x15d2",
    "დ": "0x15d3",
    "ე": "0x15d4",
    "ვ": "0x15d5",
    "ზ": "0x15d6",
    "თ": "0x15d7",
    "ი": "0x15d8",
    "კ": "0x15d9",
    "ლ": "0x15da",
    "მ": "0x15db",
    "ნ": "0x15dc",
    "ო": "0x15dd",
    "პ": "0x15de",
    "ჟ": "0x15df",
    "რ": "0x15e0",
    "ს": "0x15e1",
    "ტ": "0x15e2",
    "უ": "0x15e3",
    "ფ": "0x15e4",
    "ქ": "0x15e5",
    "ღ": "0x15e6",
    "ყ": "0x15e7",
    "შ": "0x15e8",
    "ჩ": "0x15e9",
    "ც": "0x15ea",
    "ძ": "0x15eb",
    "წ": "0x15ec",
    "ჭ": "0x15ed",
    "ხ": "0x15ee",
    "ჯ": "0x15ef",
    "ჰ": "0x15f0",
    "ჱ": "0x15f1",
    "ჲ": "0x15f2",
    "ჳ": "0x15f3",
    "ჴ": "0x15f4",
    "ჵ": "0x15f5",
    "ჶ": "0x15f6",
    "Ḃ": "0x12a1",
    "ḃ": "0x12a2",
    "Ḋ": "0x12a6",
    "Ẁ": "0x12a8",
    "Ẃ": "0x12aa",
    "ḋ": "0x12ab",
    "Ỳ": "0x12ac",
    "Ḟ": "0x12b0",
    "ḟ": "0x12b1",
    "Ṁ": "0x12b4",
    "ṁ": "0x12b5",
    "Ṗ": "0x12b7",
    "ẁ": "0x12b8",
    "ṗ": "0x12b9",
    "ẃ": "0x12ba",
    "Ṡ": "0x12bb",
    "ỳ": "0x12bc",
    "Ẅ": "0x12bd",
    "ẅ": "0x12be",
    "ṡ": "0x12bf",
    "Ŵ": "0x12d0",
    "Ṫ": "0x12d7",
    "Ŷ": "0x12de",
    "ŵ": "0x12f0",
    "ṫ": "0x12f7",
    "ŷ": "0x12fe",
    "۰": "0x0590",
    "۱": "0x0591",
    "۲": "0x0592",
    "۳": "0x0593",
    "۴": "0x0594",
    "۵": "0x0595",
    "۶": "0x0596",
    "۷": "0x0597",
    "۸": "0x0598",
    "۹": "0x0599",
    "٪": "0x05a5",
    "ٰ": "0x05a6",
    "ٹ": "0x05a7",
    "پ": "0x05a8",
    "چ": "0x05a9",
    "ڈ": "0x05aa",
    "ڑ": "0x05ab",
    "۔": "0x05ae",
    "٠": "0x05b0",
    "١": "0x05b1",
    "٢": "0x05b2",
    "٣": "0x05b3",
    "٤": "0x05b4",
    "٥": "0x05b5",
    "٦": "0x05b6",
    "٧": "0x05b7",
    "٨": "0x05b8",
    "٩": "0x05b9",
    "ٓ": "0x05f3",
    "ٔ": "0x05f4",
    "ٕ": "0x05f5",
    "ژ": "0x05f6",
    "ڤ": "0x05f7",
    "ک": "0x05f8",
    "گ": "0x05f9",
    "ں": "0x05fa",
    "ھ": "0x05fb",
    "ی": "0x05fc",
    "ے": "0x05fd",
    "ہ": "0x05fe",
    "Ғ": "0x0680",
    "Җ": "0x0681",
    "Қ": "0x0682",
    "Ҝ": "0x0683",
    "Ң": "0x0684",
    "Ү": "0x0685",
    "Ұ": "0x0686",
    "Ҳ": "0x0687",
    "Ҷ": "0x0688",
    "Ҹ": "0x0689",
    "Һ": "0x068a",
    "Ә": "0x068c",
    "Ӣ": "0x068d",
    "Ө": "0x068e",
    "Ӯ": "0x068f",
    "ғ": "0x0690",
    "җ": "0x0691",
    "қ": "0x0692",
    "ҝ": "0x0693",
    "ң": "0x0694",
    "ү": "0x0695",
    "ұ": "0x0696",
    "ҳ": "0x0697",
    "ҷ": "0x0698",
    "ҹ": "0x0699",
    "һ": "0x069a",
    "ә": "0x069c",
    "ӣ": "0x069d",
    "ө": "0x069e",
    "ӯ": "0x069f",
    "Ẋ": "0x16a3",
    "Ĭ": "0x16a6",
    "Ƶ": "0x16a9",
    "Ǧ": "0x16aa",
    "Ɵ": "0x16af",
    "ẋ": "0x16b3",
    "ĭ": "0x16b6",
    "ƶ": "0x16b9",
    "ǧ": "0x16ba",
    "ǒ": "0x16bd",
    "ɵ": "0x16bf",
    "Ə": "0x16c6",
    "ə": "0x16f6",
    "Ḷ": "0x16d1",
    "ḷ": "0x16e1",
    "Ạ": "0x1ea0",
    "ạ": "0x1ea1",
    "Ả": "0x1ea2",
    "ả": "0x1ea3",
    "Ấ": "0x1ea4",
    "ấ": "0x1ea5",
    "Ầ": "0x1ea6",
    "ầ": "0x1ea7",
    "Ẩ": "0x1ea8",
    "ẩ": "0x1ea9",
    "Ẫ": "0x1eaa",
    "ẫ": "0x1eab",
    "Ậ": "0x1eac",
    "ậ": "0x1ead",
    "Ắ": "0x1eae",
    "ắ": "0x1eaf",
    "Ằ": "0x1eb0",
    "ằ": "0x1eb1",
    "Ẳ": "0x1eb2",
    "ẳ": "0x1eb3",
    "Ẵ": "0x1eb4",
    "ẵ": "0x1eb5",
    "Ặ": "0x1eb6",
    "ặ": "0x1eb7",
    "Ẹ": "0x1eb8",
    "ẹ": "0x1eb9",
    "Ẻ": "0x1eba",
    "ẻ": "0x1ebb",
    "Ẽ": "0x1ebc",
    "ẽ": "0x1ebd",
    "Ế": "0x1ebe",
    "ế": "0x1ebf",
    "Ề": "0x1ec0",
    "ề": "0x1ec1",
    "Ể": "0x1ec2",
    "ể": "0x1ec3",
    "Ễ": "0x1ec4",
    "ễ": "0x1ec5",
    "Ệ": "0x1ec6",
    "ệ": "0x1ec7",
    "Ỉ": "0x1ec8",
    "ỉ": "0x1ec9",
    "Ị": "0x1eca",
    "ị": "0x1ecb",
    "Ọ": "0x1ecc",
    "ọ": "0x1ecd",
    "Ỏ": "0x1ece",
    "ỏ": "0x1ecf",
    "Ố": "0x1ed0",
    "ố": "0x1ed1",
    "Ồ": "0x1ed2",
    "ồ": "0x1ed3",
    "Ổ": "0x1ed4",
    "ổ": "0x1ed5",
    "Ỗ": "0x1ed6",
    "ỗ": "0x1ed7",
    "Ộ": "0x1ed8",
    "ộ": "0x1ed9",
    "Ớ": "0x1eda",
    "ớ": "0x1edb",
    "Ờ": "0x1edc",
    "ờ": "0x1edd",
    "Ở": "0x1ede",
    "ở": "0x1edf",
    "Ỡ": "0x1ee0",
    "ỡ": "0x1ee1",
    "Ợ": "0x1ee2",
    "ợ": "0x1ee3",
    "Ụ": "0x1ee4",
    "ụ": "0x1ee5",
    "Ủ": "0x1ee6",
    "ủ": "0x1ee7",
    "Ứ": "0x1ee8",
    "ứ": "0x1ee9",
    "Ừ": "0x1eea",
    "ừ": "0x1eeb",
    "Ử": "0x1eec",
    "ử": "0x1eed",
    "Ữ": "0x1eee",
    "ữ": "0x1eef",
    "Ự": "0x1ef0",
    "ự": "0x1ef1",
    "Ỵ": "0x1ef4",
    "ỵ": "0x1ef5",
    "Ỷ": "0x1ef6",
    "ỷ": "0x1ef7",
    "Ỹ": "0x1ef8",
    "ỹ": "0x1ef9",
    "Ơ": "0x1efa",
    "ơ": "0x1efb",
    "Ư": "0x1efc",
    "ư": "0x1efd",
    "̉": "0xfe61",
    "̣": "0xfe60",
    "̛": "0xfe62"
};
const server = http.createServer(app);
const {
  Server
} = require("socket.io");
const io = new Server(server);
app.get("/", (e, n) => {
  n.send(`<!DOCTYPE HTML>
<html>
<head>
    <script src="/socket.io/socket.io.js"></script>
</head>

<body>
    <img id="frame">
    <script>
	var ignore = ["Backspace", "Enter"]
	function arrayFindIncludes(key, arr) {
    var result;
    var none = null;
    arr.forEach(function(k) {
        if (k == key) {
            result = k;
            none = k;
        } else {
            result = none;
        }
    })
    return result;
}

        var socket = io();
        socket.emit("run");
        socket.on("frame", (url) => {
            document.getElementById("frame").src = url;
        })

        window.onkeydown = function(e) {
		if (!arrayFindIncludes(e.key, ignore)) {
		                socket.emit('keydown', e.key);
		} else {
		if (e.key == "Enter") {
		                socket.emit('keydown', "\\r");
						} else if (e.key == "Backspace") {
								                socket.emit('keydown', "\\b");
						}
}
        }
		
window.onclick = function(e) {
		                socket.emit('mousedown', e);
}

window.onmousemove = function(e) {
		                socket.emit('mousemove', e);
}
    </script>
</body>
</html>`)
});
io.on("connection", e => {
  e.on("run", () => {
    if (!isRunning) {
      isRunning = true;
      global.client = new VncClient;
      client.changeFps(100);
      client.connect({
        host: "127.0.0.1",
        port: 5901
      });
      client.on("connectError", e => {
        console.log(e)
      });
      client.on("authError", () => {
        console.log("Authentication failed.")
      });
      client.on("frameUpdated", e => {
        new Jimp({
          width: client.clientWidth,
          height: client.clientHeight,
          data: client.getFb()
        }, (e, n) => {
          if (e) {
            console.log(e)
          }
          const t = `machine.jpg`;
          n.write(`${t}`)
        });
        io.emit("frame", "data:image/png;base64," + fs.readFileSync("machine.jpg").toString("base64"))
      });
      e.on("keydown", function(e) {
        var n = e;
        console.log(n, keysyms[n]);
        client.sendKeyEvent(keysyms[n], true)
      })
    } else {
      e.on("keydown", function(e) {
        var n = e;
        console.log(n, keysyms[n]);
        client.sendKeyEvent(keysyms[n], true)
      });
      io.emit("frame", "data:image/png;base64," + fs.readFileSync("machine.jpg").toString("base64"))
    }
  })
});
server.listen(3e3, () => {
  console.log("listening on localhost:3000")
});
